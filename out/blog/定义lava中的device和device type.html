<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><meta charSet="utf-8"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/><link rel="preload" href="/_next/static/css/87c5501326a0a136.css" as="style"/><link rel="stylesheet" href="/_next/static/css/87c5501326a0a136.css" data-n-g=""/><link rel="preload" href="/_next/static/css/be6283f520727b8c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/be6283f520727b8c.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-08b9b58f7ffa7394.js" defer=""></script><script src="/_next/static/chunks/framework-b96261d959dd50e7.js" defer=""></script><script src="/_next/static/chunks/main-33b20194e9037899.js" defer=""></script><script src="/_next/static/chunks/pages/_app-0203a97b51327b56.js" defer=""></script><script src="/_next/static/chunks/106-a71b11894cb18610.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bid%5D-de3cde25ea3e1e92.js" defer=""></script><script src="/_next/static/buStSiZrItMjUgENubp7x/_buildManifest.js" defer=""></script><script src="/_next/static/buStSiZrItMjUgENubp7x/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="layout"><header class="nav"><div class="nav-container"><a href="/" class="nav-brand">我的博客</a><div class="nav-links"><a href="/" class="nav-link">首页</a><a href="/blog" class="nav-link">文章</a><a href="/categories" class="nav-link">分类</a><a href="/about" class="nav-link">关于我</a></div></div></header><main><article class="article_container__uEGY_"><header class="article_header__Dfu8i"><h1 class="article_title__Kemkb">定义 LAVA 中的设备和设备类型</h1><div class="article_meta__EQMJH"><span class="article_date__8Zsel">2024-01-14</span><a class="article_category__FEprG" href="/articles?category=%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91">测试开发</a><span class="ViewCounter_viewCount__CArR4">--</span></div><div class="article_tags__SeZQL"><a class="article_tag__xFxqV" href="/articles?tag=LAVA">#<!-- -->LAVA</a><a class="article_tag__xFxqV" href="/articles?tag=%E8%AE%BE%E5%A4%87%E7%AE%A1%E7%90%86">#<!-- -->设备管理</a><a class="article_tag__xFxqV" href="/articles?tag=%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95">#<!-- -->自动化测试</a><a class="article_tag__xFxqV" href="/articles?tag=%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86">#<!-- -->配置管理</a></div></header><div class="article_content__xXtEi"><h1>定义lava中的device和device type</h1>
<ol>
<li>
<p>lava中有默认的device types，存放在lava master的<code>/usr/share/lava-server/device-types</code>目录下。也可以使用<code>lava-server manage device-types list --all</code>列出所有的设备类型。<code>lava-server manage devices list -all</code>可以列出所有设备。每一个device-type在<code>/usr/share/lava-server/device-types</code>目录下都有一个jinja2文件定义这个设备类型。比较常用的是<code>qemu.jinja2</code>，这个文件会在定义设备类型为qemu的设备时使用</p>
</li>
<li>
<p>设备存储在lava master的<code>/etc/lava-server/dispatcher-config/devices</code>目录下，每一个设备都有一个jinja2文件，内容例如：</p>
<pre><code class="language-jinja2">{% extends 'qemu.jinja2' %}
{% set no_kvm = True %}
</code></pre>
<p>第一行的extends引用了qemu这个设备类型的jinja2模板，后面可以覆写模板里面的一些值</p>
</li>
<li>
<p>增加新的设备可以在UI中操作，增加完之后需要注意在<code>/etc/lava-server/dispatcher-config/devices</code>目录下需要新增一个文件名和设备名称相同，后缀是<code>.jinja2</code>的文件。需要注意增加的设备需要有healthcheck，新设备extends引用的jinja2文件将文件名保留，后缀改成.yaml就是health-check的定义。如果新设备的类型是qemu，那么health-checks定义在<code>/etc/lava-server/dispatcher-config/health-checks/qemu.yaml</code>。</p>
</li>
<li>
<p>如果增加lava中提供的设备类型，直接使用<code>lava-server manage device-types add xxx</code>就可以。
（没尝试过）如果要自己增加设备类型，使用ui或者命令新增设备之后，需要在<code>/etc/lava-server/dispatcher-config/device-types/</code>下创建对应的<code>.jinja2</code>文件</p>
</li>
</ol>
</div><footer class="article_footer__5JN_G"><div class="article_navigation__fJhBJ"><a class="article_backButton__FZQSF" href="/blog">返回文章列表</a></div></footer></article></main><footer class="footer"><p>© 2024 个人博客. All rights reserved.</p></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"article":{"id":"定义lava中的device和device type","contentHtml":"\u003ch1\u003e定义lava中的device和device type\u003c/h1\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003elava中有默认的device types，存放在lava master的\u003ccode\u003e/usr/share/lava-server/device-types\u003c/code\u003e目录下。也可以使用\u003ccode\u003elava-server manage device-types list --all\u003c/code\u003e列出所有的设备类型。\u003ccode\u003elava-server manage devices list -all\u003c/code\u003e可以列出所有设备。每一个device-type在\u003ccode\u003e/usr/share/lava-server/device-types\u003c/code\u003e目录下都有一个jinja2文件定义这个设备类型。比较常用的是\u003ccode\u003eqemu.jinja2\u003c/code\u003e，这个文件会在定义设备类型为qemu的设备时使用\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e设备存储在lava master的\u003ccode\u003e/etc/lava-server/dispatcher-config/devices\u003c/code\u003e目录下，每一个设备都有一个jinja2文件，内容例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-jinja2\"\u003e{% extends 'qemu.jinja2' %}\r\n{% set no_kvm = True %}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e第一行的extends引用了qemu这个设备类型的jinja2模板，后面可以覆写模板里面的一些值\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e增加新的设备可以在UI中操作，增加完之后需要注意在\u003ccode\u003e/etc/lava-server/dispatcher-config/devices\u003c/code\u003e目录下需要新增一个文件名和设备名称相同，后缀是\u003ccode\u003e.jinja2\u003c/code\u003e的文件。需要注意增加的设备需要有healthcheck，新设备extends引用的jinja2文件将文件名保留，后缀改成.yaml就是health-check的定义。如果新设备的类型是qemu，那么health-checks定义在\u003ccode\u003e/etc/lava-server/dispatcher-config/health-checks/qemu.yaml\u003c/code\u003e。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e如果增加lava中提供的设备类型，直接使用\u003ccode\u003elava-server manage device-types add xxx\u003c/code\u003e就可以。\r\n（没尝试过）如果要自己增加设备类型，使用ui或者命令新增设备之后，需要在\u003ccode\u003e/etc/lava-server/dispatcher-config/device-types/\u003c/code\u003e下创建对应的\u003ccode\u003e.jinja2\u003c/code\u003e文件\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n","title":"定义 LAVA 中的设备和设备类型","date":"2024-01-14","category":"测试开发","tags":["LAVA","设备管理","自动化测试","配置管理"],"summary":"详细说明 LAVA 中设备和设备类型的定义方法，包括配置文件的位置、格式和管理方式。","views":0}},"__N_SSG":true},"page":"/blog/[id]","query":{"id":"定义lava中的device和device type"},"buildId":"buStSiZrItMjUgENubp7x","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>