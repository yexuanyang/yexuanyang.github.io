{"pageProps":{"article":{"id":"使用XML_RPC向lava中提交测试作业","contentHtml":"<h1>使用XML-RPC向lava中提交测试作业</h1>\n<ol>\n<li>\n<p>访问lava集群的web页面，点开API中的<code>Available Methods</code>可以看到XML-RPC支持的所有方法，里面有一个方法是scheduler.jobs.submit，如果集群部署在<code>10.161.28.28:9999</code>那么访问<code>http://10.161.28.28:9999/api/help/</code>可以看到所有的API</p>\n</li>\n<li>\n<p>查看目前有的token，访问<code>http://10.161.28.28:9999/api/tokens/</code>，选一个用来做XML_RPC</p>\n</li>\n<li>\n<p>编写要提交的任务<code>basic.yaml</code>：</p>\n<pre><code class=\"language-yaml\"> device_type: qemu\r\n job_name: RROS_TEST test basic_bash.yaml\r\n\r\n timeouts:\r\n job:\r\n     minutes: 15\r\n action:\r\n     minutes: 5\r\n connection:\r\n     minutes: 2\r\n priority: medium\r\n visibility: public\r\n context:\r\n arch: aarch64\r\n memory: 2048\r\n guestfs_interface: virtio\r\n machine: virt\r\n cpu: cortex-a57\r\n extra_options:\r\n - -smp 1\r\n - -device virtio-blk-device,drive=hd0\r\n - -append \"console=ttyAMA0 root=/dev/vda2 rw\"\r\n\r\n actions: \r\n - deploy:\r\n     timeout: \r\n     minutes: 5\r\n     to: tmpfs\r\n     images:\r\n     kernel:\r\n         image_arg: -kernel {kernel}\r\n         url: file:///data/user_home/yyx/images/rros_arch_jenkins/arm64/boot/Image\r\n     rootfs:\r\n         image_arg: -drive if=none,file={rootfs},id=hd0,format=raw\r\n         url: file:///data/user_home/yyx/images/lhy_2022-01-28-raspios-bullseye-arm64_poll.img\r\n - boot:\r\n     method: qemu\r\n     media: tmpfs\r\n     timeout:\r\n     minutes: 5\r\n     auto_login:\r\n     login_prompt: \"raspberrypi login:\"\r\n     username: root\r\n     password_prompt: \"Password:\"\r\n     password: 519ailab\r\n     prompts:\r\n     - \"root@raspberrypi:\"\r\n - test:\r\n     timeout:\r\n     minutes: 5\r\n     definitions:\r\n     - repository: https://github.com/yexuanyang/my_pipeline.git\r\n     from: git\r\n     path: basic_bash.yaml\r\n     name: basic-bash\n</code></pre>\n<p>其中test下的basic_bash.yaml是lava中的test defination，内容如下：</p>\n<pre><code class=\"language-yaml\"> metadata:\r\n format: Lava-Test Test Defination 1.0\r\n name: basic-bash\r\n description: \"Basic (Level 1) Test basic bash in RROS\"\r\n maintainer:\r\n     - myemailyyxg@gmail.com\r\n\r\n run:\r\n steps:\r\n     - lava-test-case test-pwd --shell pwd\r\n     - lava-test-case test-ls --shell ls $(pwd)\r\n     - chmod +x basic_bash.sh\r\n     - lava-test-case test-script --shell ./basic_bash.sh\n</code></pre>\n</li>\n<li>\n<p>编写python脚本：</p>\n<pre><code class=\"language-python\"> # Python3\r\n import yaml\r\n import xmlrpc.client\r\n\r\n with open('basic.yaml') as f:\r\n     config = yaml.dump(yaml.load(f, yaml.FullLoader))\r\n     server=xmlrpc.client.ServerProxy(\"http://admin:longrandomtokenadmin@10.161.28.28:9999/RPC2/\")\r\n     jobid=server.scheduler.submit_job(config)\n</code></pre>\n</li>\n<li>\n<p>运行这个脚本即可向lava集群提交一个新的job</p>\n</li>\n</ol>\n","title":"使用 XML-RPC 向 LAVA 提交测试作业","date":"2024-01-13","category":"测试开发","tags":["LAVA","XML-RPC","自动化测试","Python"],"summary":"介绍如何使用 XML-RPC 接口向 LAVA 测试集群提交测试作业，包括配置文件编写和 Python 脚本实现。","views":0}},"__N_SSG":true}