<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/><link rel="preload" href="/_next/static/css/51e0adf13c27d156.css" as="style"/><link rel="stylesheet" href="/_next/static/css/51e0adf13c27d156.css" data-n-g=""/><link rel="preload" href="/_next/static/css/be6283f520727b8c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/be6283f520727b8c.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-8cac0b4b405cede1.js" defer=""></script><script src="/_next/static/chunks/framework-b96261d959dd50e7.js" defer=""></script><script src="/_next/static/chunks/main-5641a5f61dc27c0f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-0203a97b51327b56.js" defer=""></script><script src="/_next/static/chunks/106-a71b11894cb18610.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bid%5D-6906bb05a49b61d5.js" defer=""></script><script src="/_next/static/W8d23itBBCSxsZpM0m5il/_buildManifest.js" defer=""></script><script src="/_next/static/W8d23itBBCSxsZpM0m5il/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="layout"><header class="nav"><div class="nav-container"><a href="/" class="nav-brand">我的博客</a><div class="nav-links"><a href="/" class="nav-link">首页</a><a href="/blog" class="nav-link">文章</a><a href="/categories" class="nav-link">分类</a><a href="/about" class="nav-link">关于我</a></div></div></header><main class="container"><article class="article_container__uEGY_"><header class="article_header__Dfu8i"><h1 class="article_title__Kemkb">使用 Docker 搭建 LAVA 测试集群</h1><div class="article_meta__EQMJH"><span class="article_date__8Zsel">2024-01-12</span><a class="article_category__FEprG" href="/articles?category=%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91">测试开发</a><span class="ViewCounter_viewCount__CArR4"><i class="far fa-eye"></i> -- 次浏览</span></div><div class="article_tags__SeZQL"><a class="article_tag__xFxqV" href="/articles?tag=Docker">#<!-- -->Docker</a><a class="article_tag__xFxqV" href="/articles?tag=LAVA">#<!-- -->LAVA</a><a class="article_tag__xFxqV" href="/articles?tag=%E6%B5%8B%E8%AF%95%E9%9B%86%E7%BE%A4">#<!-- -->测试集群</a><a class="article_tag__xFxqV" href="/articles?tag=%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95">#<!-- -->自动化测试</a></div></header><div class="article_content__xXtEi"><h1>使用docker搭建lava测试集群</h1>
<ol>
<li>使用docker-compose:
<ol>
<li>
<p>首先需要下载docker-compose，<code>apt install docker-compose</code>。整个集群的搭建由docker-compose创建</p>
</li>
<li>
<p><code>git clone https://github.com/kernelci/lava-docker.git</code>将lava-docker拉下来</p>
</li>
<li>
<p>编辑<code>lavalan-gen.py</code>，这样生出来的<code>docker-compose.yml</code>可以直接使用：
<strong>master:</strong></p>
<pre><code class="language-python">dockcomp = {}
dockcomp["version"] = "2.0"
dockcomp["services"] = {}
dockcomposeymlpath = "output/%s/docker-compose.yml" % host
dockcomp["services"][name] = {}
dockcomp["services"][name]["hostname"] = name
dockcomp["services"][name]["ports"] = [ listen_address + ":" + str(webinterface_port) + ":80"]
dockcomp["services"][name]["volumes"] = [ "/boot:/boot", "/lib/modules:/lib/modules" ]
dockcomp["services"][name]["build"] = {}
dockcomp["services"][name]["build"]["context"] = name
</code></pre>
<p><strong>slave:</strong></p>
<pre><code class="language-python">dockcomp["services"][name] = {}
dockcomp["services"][name]["hostname"] = name
dockcomp["services"][name]["dns_search"] = ""
dockcomp["services"][name]["ports"] = []
dockcomp["services"][name]["volumes"] = [ "/boot:/boot", "/lib/modules:/lib/modules", "/data/user_home/yyx:/data/user_home/yyx" ]
dockcomp["services"][name]["environment"] = {}
dockcomp["services"][name]["build"] = {}
dockcomp["services"][name]["build"]["context"] = name
dockcomp["services"][name]["privileged"] = True
</code></pre>
</li>
<li>
<p>配置<code>boards.yaml</code>文件：</p>
<pre><code class="language-YAML">masters:
- name: master
    host: lava-test-1
    webinterface_port: 9999      
    allowed_hosts: ['*']         
    users:
    - name: admin
        token: longrandomtokenadmin
        password: admin
        superuser: true
        staff: true
slaves:
- name: lab-slave-1
    host: lava-test-1
    remote_master: master
    remote_user: admin
    dispatcher_ip: 10.161.28.28 

boards:
- name: qemu-test
    type: qemu
    slave: lab-slave-1
- name: qemu-test-1
    type: qemu
    slave: lab-slave-1

</code></pre>
<p>文件中的dispatcher_ip要设置成运行<code>docker-compose</code>的服务器ip地址
<code>type</code>指定设备的类型。</p>
</li>
<li>
<p>运行下列命令启动lava测试集群：</p>
<pre><code class="language-bash">./lavalab-gen.py
cd output/lava-test-1
docker-compose build
docker-compose up -d
</code></pre>
</li>
<li>
<p>运行完之后访问<code>boards.yaml</code>里面指定的<code>dispatcher_ip:webinterface_port</code>即可访问lava的网页。账号密码是<code>boards.yaml</code>里面的<code>users</code>指定的<code>name</code>和<code>password</code>，那个token用来作为使用<code>XML-RPC</code>时指定的<code>token</code></p>
</li>
</ol>
</li>
</ol>
</div><footer class="article_footer__5JN_G"><div class="article_navigation__fJhBJ"><a class="article_backButton__FZQSF" href="/blog">返回文章列表</a></div></footer></article></main><footer class="footer"><p>© 2024 个人博客. All rights reserved.</p></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"article":{"id":"使用docker搭建lava测试集群","contentHtml":"\u003ch1\u003e使用docker搭建lava测试集群\u003c/h1\u003e\n\u003col\u003e\n\u003cli\u003e使用docker-compose:\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e首先需要下载docker-compose，\u003ccode\u003eapt install docker-compose\u003c/code\u003e。整个集群的搭建由docker-compose创建\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003egit clone https://github.com/kernelci/lava-docker.git\u003c/code\u003e将lava-docker拉下来\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e编辑\u003ccode\u003elavalan-gen.py\u003c/code\u003e，这样生出来的\u003ccode\u003edocker-compose.yml\u003c/code\u003e可以直接使用：\r\n\u003cstrong\u003emaster:\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003edockcomp = {}\r\ndockcomp[\"version\"] = \"2.0\"\r\ndockcomp[\"services\"] = {}\r\ndockcomposeymlpath = \"output/%s/docker-compose.yml\" % host\r\ndockcomp[\"services\"][name] = {}\r\ndockcomp[\"services\"][name][\"hostname\"] = name\r\ndockcomp[\"services\"][name][\"ports\"] = [ listen_address + \":\" + str(webinterface_port) + \":80\"]\r\ndockcomp[\"services\"][name][\"volumes\"] = [ \"/boot:/boot\", \"/lib/modules:/lib/modules\" ]\r\ndockcomp[\"services\"][name][\"build\"] = {}\r\ndockcomp[\"services\"][name][\"build\"][\"context\"] = name\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eslave:\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003edockcomp[\"services\"][name] = {}\r\ndockcomp[\"services\"][name][\"hostname\"] = name\r\ndockcomp[\"services\"][name][\"dns_search\"] = \"\"\r\ndockcomp[\"services\"][name][\"ports\"] = []\r\ndockcomp[\"services\"][name][\"volumes\"] = [ \"/boot:/boot\", \"/lib/modules:/lib/modules\", \"/data/user_home/yyx:/data/user_home/yyx\" ]\r\ndockcomp[\"services\"][name][\"environment\"] = {}\r\ndockcomp[\"services\"][name][\"build\"] = {}\r\ndockcomp[\"services\"][name][\"build\"][\"context\"] = name\r\ndockcomp[\"services\"][name][\"privileged\"] = True\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e配置\u003ccode\u003eboards.yaml\u003c/code\u003e文件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-YAML\"\u003emasters:\r\n- name: master\r\n    host: lava-test-1\r\n    webinterface_port: 9999      \r\n    allowed_hosts: ['*']         \r\n    users:\r\n    - name: admin\r\n        token: longrandomtokenadmin\r\n        password: admin\r\n        superuser: true\r\n        staff: true\r\nslaves:\r\n- name: lab-slave-1\r\n    host: lava-test-1\r\n    remote_master: master\r\n    remote_user: admin\r\n    dispatcher_ip: 10.161.28.28 \r\n\r\nboards:\r\n- name: qemu-test\r\n    type: qemu\r\n    slave: lab-slave-1\r\n- name: qemu-test-1\r\n    type: qemu\r\n    slave: lab-slave-1\r\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e文件中的dispatcher_ip要设置成运行\u003ccode\u003edocker-compose\u003c/code\u003e的服务器ip地址\r\n\u003ccode\u003etype\u003c/code\u003e指定设备的类型。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e运行下列命令启动lava测试集群：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e./lavalab-gen.py\r\ncd output/lava-test-1\r\ndocker-compose build\r\ndocker-compose up -d\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e运行完之后访问\u003ccode\u003eboards.yaml\u003c/code\u003e里面指定的\u003ccode\u003edispatcher_ip:webinterface_port\u003c/code\u003e即可访问lava的网页。账号密码是\u003ccode\u003eboards.yaml\u003c/code\u003e里面的\u003ccode\u003eusers\u003c/code\u003e指定的\u003ccode\u003ename\u003c/code\u003e和\u003ccode\u003epassword\u003c/code\u003e，那个token用来作为使用\u003ccode\u003eXML-RPC\u003c/code\u003e时指定的\u003ccode\u003etoken\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n","title":"使用 Docker 搭建 LAVA 测试集群","date":"2024-01-12","category":"测试开发","tags":["Docker","LAVA","测试集群","自动化测试"],"summary":"详细介绍如何使用 Docker 和 docker-compose 搭建 LAVA 测试集群，包括配置文件的编写和集群的启动过程。","views":0}},"__N_SSG":true},"page":"/blog/[id]","query":{"id":"使用docker搭建lava测试集群"},"buildId":"W8d23itBBCSxsZpM0m5il","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>