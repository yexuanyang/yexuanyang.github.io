{"pageProps":{"article":{"id":"使用docker搭建lava测试集群","contentHtml":"<h1>使用docker搭建lava测试集群</h1>\n<ol>\n<li>使用docker-compose:\n<ol>\n<li>\n<p>首先需要下载docker-compose，<code>apt install docker-compose</code>。整个集群的搭建由docker-compose创建</p>\n</li>\n<li>\n<p><code>git clone https://github.com/kernelci/lava-docker.git</code>将lava-docker拉下来</p>\n</li>\n<li>\n<p>编辑<code>lavalan-gen.py</code>，这样生出来的<code>docker-compose.yml</code>可以直接使用：\r\n<strong>master:</strong></p>\n<pre><code class=\"language-python\">dockcomp = {}\r\ndockcomp[\"version\"] = \"2.0\"\r\ndockcomp[\"services\"] = {}\r\ndockcomposeymlpath = \"output/%s/docker-compose.yml\" % host\r\ndockcomp[\"services\"][name] = {}\r\ndockcomp[\"services\"][name][\"hostname\"] = name\r\ndockcomp[\"services\"][name][\"ports\"] = [ listen_address + \":\" + str(webinterface_port) + \":80\"]\r\ndockcomp[\"services\"][name][\"volumes\"] = [ \"/boot:/boot\", \"/lib/modules:/lib/modules\" ]\r\ndockcomp[\"services\"][name][\"build\"] = {}\r\ndockcomp[\"services\"][name][\"build\"][\"context\"] = name\n</code></pre>\n<p><strong>slave:</strong></p>\n<pre><code class=\"language-python\">dockcomp[\"services\"][name] = {}\r\ndockcomp[\"services\"][name][\"hostname\"] = name\r\ndockcomp[\"services\"][name][\"dns_search\"] = \"\"\r\ndockcomp[\"services\"][name][\"ports\"] = []\r\ndockcomp[\"services\"][name][\"volumes\"] = [ \"/boot:/boot\", \"/lib/modules:/lib/modules\", \"/data/user_home/yyx:/data/user_home/yyx\" ]\r\ndockcomp[\"services\"][name][\"environment\"] = {}\r\ndockcomp[\"services\"][name][\"build\"] = {}\r\ndockcomp[\"services\"][name][\"build\"][\"context\"] = name\r\ndockcomp[\"services\"][name][\"privileged\"] = True\n</code></pre>\n</li>\n<li>\n<p>配置<code>boards.yaml</code>文件：</p>\n<pre><code class=\"language-YAML\">masters:\r\n- name: master\r\n    host: lava-test-1\r\n    webinterface_port: 9999      \r\n    allowed_hosts: ['*']         \r\n    users:\r\n    - name: admin\r\n        token: longrandomtokenadmin\r\n        password: admin\r\n        superuser: true\r\n        staff: true\r\nslaves:\r\n- name: lab-slave-1\r\n    host: lava-test-1\r\n    remote_master: master\r\n    remote_user: admin\r\n    dispatcher_ip: 10.161.28.28 \r\n\r\nboards:\r\n- name: qemu-test\r\n    type: qemu\r\n    slave: lab-slave-1\r\n- name: qemu-test-1\r\n    type: qemu\r\n    slave: lab-slave-1\r\n\n</code></pre>\n<p>文件中的dispatcher_ip要设置成运行<code>docker-compose</code>的服务器ip地址\r\n<code>type</code>指定设备的类型。</p>\n</li>\n<li>\n<p>运行下列命令启动lava测试集群：</p>\n<pre><code class=\"language-bash\">./lavalab-gen.py\r\ncd output/lava-test-1\r\ndocker-compose build\r\ndocker-compose up -d\n</code></pre>\n</li>\n<li>\n<p>运行完之后访问<code>boards.yaml</code>里面指定的<code>dispatcher_ip:webinterface_port</code>即可访问lava的网页。账号密码是<code>boards.yaml</code>里面的<code>users</code>指定的<code>name</code>和<code>password</code>，那个token用来作为使用<code>XML-RPC</code>时指定的<code>token</code></p>\n</li>\n</ol>\n</li>\n</ol>\n","title":"使用 Docker 搭建 LAVA 测试集群","date":"2024-01-12","category":"测试开发","tags":["Docker","LAVA","测试集群","自动化测试"],"summary":"详细介绍如何使用 Docker 和 docker-compose 搭建 LAVA 测试集群，包括配置文件的编写和集群的启动过程。","views":0}},"__N_SSG":true}